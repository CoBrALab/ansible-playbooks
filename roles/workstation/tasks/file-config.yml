- name: config apcupsd.conf
  copy: src=files/apcupsd.conf dest=/etc/apcupsd/apcupsd.conf
  notify:
    - restart apcupsd

- name: config apcupsd
  copy: src=files/apcupsd dest=/etc/default/apcupsd
  notify:
    - restart apcupsd

- name: install ppds
  copy: src={{ item }} dest=/etc/cups/ppd
  with_items:
    - files/Kyocera-Mita-TASKalfa-3253ci-KPDL.ppd
  notify:
    - restart cups
    - restart cups-browsed

- name: install printer.conf
  copy: src=files/printers.conf dest=/etc/cups
  notify:
    - restart cups
    - restart cups-browsed

- name: install cups-browsed.conf
  copy: src=files/cups-browsed.conf dest=/etc/cups
  notify:
    - restart cups
    - restart cups-browsed

- name: install cupsd.conf
  copy: src=files/cupsd.conf dest=/etc/cups
  notify:
    - restart cups
    - restart cups-browsed

- name: disable cups-browsed
  service: name=cups-browsed enabled=no state=stopped

- name: create sddm config dir
  file:
    path: /etc/sddm.conf.d
    state: directory

- name: copy sddm config to enable graphical logins
  copy: src=files/sddm_local dest=/etc/sddm.conf.d

- name: make plasma default
  file:
    src: /usr/share/xsessions/plasma.desktop
    dest: /usr/share/xsessions/0plasma.desktop
    state: link

- name: Fix kcheckpass
  file:
    path: /usr/lib/x86_64-linux-gnu/libexec/kcheckpass
    mode: u+s

- name: Flush handlers
  meta: flush_handlers
